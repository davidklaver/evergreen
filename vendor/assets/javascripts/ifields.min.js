var cardFrameLoaded=!1,cvvFrameLoaded=!1,cardTokenRecieved=!1,cvvTokenRecieved=!1,tokensReceived=!1,latestErrorTime=new Date,cachedIFieldStyles={},cachedAccountxKey="",cachedAccountSoftwareName="",cachedAccountSoftwareVersion="";function getByCustomAttribute(a,b){return document.querySelector("["+a+"='"+b+"']")}
window.addEventListener("message",function(a){var b=a.data;if("loaded"===b.action){console.log("Message received: ifield loaded");b=document.getElementsByTagName("iframe");for(var c=0;c<b.length;c++)if(b[c].contentWindow==a.source){var d=b[c].getAttribute("data-ifields-id");var e=b[c].getAttribute("data-ifields-placeholder");break}console.log("Loaded ifield id: "+d);for(var f in cachedIFieldStyles)setIfieldStyle(f,cachedIFieldStyles[f]);setAccount(cachedAccountxKey,cachedAccountSoftwareName,cachedAccountSoftwareVersion);
"card-number"===d?(a.source.postMessage({action:"init",tokenType:"card"},"*"),setPlaceholder(d,e),cardFrameLoaded=!0):"cvv"===d&&(a.source.postMessage({action:"init",tokenType:"cvv"},"*"),setPlaceholder(d,e),cvvFrameLoaded=!0)}else"token"===b.action&&(console.log("Message recived: token"),"error"===b.data.result?(latestErrorTime=new Date,getByCustomAttribute("data-ifields-id","card-data-error").innerHTML=b.data.errorMessage):"card"===b.data.xTokenType?(getByCustomAttribute("data-ifields-id","card-number-token").value=
b.data.xToken,cardTokenRecieved=!0):"cvv"===b.data.xTokenType&&(getByCustomAttribute("data-ifields-id","cvv-token").value=b.data.xToken,cvvTokenRecieved=!0))},!1);function iFieldElementExists(a){return"undefined"!==typeof getByCustomAttribute("data-ifields-id",a)}
function getTokens(a,b,c){if(null===c||void 0===c||isNaN(c)||0>=c)c=6E4;void 0===a&&(a=Function.prototype);void 0===b&&(b=Function.prototype);cvvTokenRecieved=cardTokenRecieved=!1;getByCustomAttribute("data-ifields-id","card-number-token").value="";getByCustomAttribute("data-ifields-id","cvv-token").value="";getByCustomAttribute("data-ifields-id","card-data-error").innerHTML="";tokensReceived=!1;var d={action:"getToken"};if(iFieldElementExists("card-number"))var e=setInterval(function(){cardFrameLoaded&&
(clearInterval(e),getByCustomAttribute("data-ifields-id","card-number").contentWindow.postMessage(d,"*"))},100);if(iFieldElementExists("cvv"))var f=setInterval(function(){cvvFrameLoaded&&(clearInterval(f),getByCustomAttribute("data-ifields-id","cvv").contentWindow.postMessage(d,"*"))},100);var l=iFieldElementExists("card-number"),m=iFieldElementExists("cvv"),g=setInterval(function(){0!=l&&!cardTokenRecieved||0!=m&&!cvvTokenRecieved||(clearInterval(g),tokensReceived=!0,getByCustomAttribute("data-ifields-id",
"card-data-error").innerHTML="",a())},100),k=(new Date).getTime(),h=setInterval(function(){var a=(new Date).getTime();k<latestErrorTime?(clearInterval(e),clearInterval(f),clearInterval(h),clearInterval(g),b()):tokensReceived?clearInterval(h):a-k>c&&(clearInterval(e),clearInterval(f),clearInterval(h),clearInterval(g),getByCustomAttribute("data-ifields-id","card-data-error").innerHTML="Transaction timed out",b())},100)}
function clearIfield(a){console.log("Clearing ifield data for iframe id "+a);getByCustomAttribute("data-ifields-id",a).contentWindow.postMessage({action:"clearData"},"*")}
function setIfieldStyle(a,b){cachedIFieldStyles[a]=b;var c=setInterval(function(){if(iFieldElementExists(a)&&("card-number"===a&&cardFrameLoaded||"cvv"===a&&cvvFrameLoaded)){clearInterval(c);var d={action:"style",data:b};console.log("Setting ifield style for iframe id "+a);getByCustomAttribute("data-ifields-id",a).contentWindow.postMessage(d,"*")}},100)}
function setPlaceholder(a,b){b={action:"setPlaceholder",data:b};console.log("Setting ifield placeholder for iframe id "+a);getByCustomAttribute("data-ifields-id",a).contentWindow.postMessage(b,"*")}
function setAccount(a,b,c){cachedAccountxKey=a;cachedAccountSoftwareName=b;cachedAccountSoftwareVersion=c;var d={action:"setAccountData",data:{xKey:a,xSoftwareName:b,xSoftwareVersion:c}};if(iFieldElementExists("card-number"))var e=setInterval(function(){cardFrameLoaded&&(clearInterval(e),console.log("Setting ifield account data for iframe id card-number"),getByCustomAttribute("data-ifields-id","card-number").contentWindow.postMessage(d,"*"))},100);if(iFieldElementExists("cvv"))var f=setInterval(function(){cvvFrameLoaded&&
(clearInterval(f),console.log("Setting ifield account data for iframe id cvv"),getByCustomAttribute("data-ifields-id","cvv").contentWindow.postMessage(d,"*"))},100)};